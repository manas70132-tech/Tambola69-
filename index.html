<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tambola 69 - User App</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#111;color:#fff;text-align:center;padding:12px}
  h1,h2,h3{color:orange;margin:8px 0}
  .ticket-cell{width:40px;height:40px;display:inline-flex;align-items:center;justify-content:center;
    border:1px solid #333;margin:2px;border-radius:6px;background:#222;font-weight:bold;color:#fff}
  .ticket-cell.ticked{background:green;color:#fff}
  .highlight{background:yellow!important;color:#000!important}
  .btn{padding:8px 12px;margin:6px;border:none;border-radius:6px;cursor:pointer;font-weight:bold}
  .btn-primary{background:orange;color:#000}
  .btn-danger{background:#ff4d4f;color:#fff}
  #liveVideoBox{display:none;margin-top:10px}
  #playersList{font-size:14px;margin:10px 0}
  #withdrawModal{display:none;position:fixed;top:20%;left:50%;transform:translateX(-50%);
    background:#222;padding:16px;border-radius:8px;z-index:999}
</style>
</head>
<body>
<h1>Tambola 69 - User App</h1>

<!-- Ticket & Game UI -->
<div id="userTicketContainer"></div>
<p id="latestNumber">—</p>
<p id="history">None</p>
<div id="board"></div>

<!-- Buttons -->
<button class="btn btn-primary" id="createRoomBtn">Create Room</button>
<input id="joinRoomIdInput" placeholder="Room ID" />
<button class="btn btn-primary" id="joinRoomBtn">Join Room</button>
<button class="btn btn-primary" id="roomBuyTicketBtn" style="display:none">Buy Ticket</button>
<button class="btn btn-primary" id="startRoomGameBtn" style="display:none">Start Game</button>

<p id="roomInfo"></p>
<p id="roomStatusPill"></p>
<p id="playersList"></p>

<!-- Withdraw Modal -->
<div id="withdrawModal">
  <h3>Withdraw Request</h3>
  <input id="withdrawAmt" placeholder="Amount" /><br/>
  <input id="withdrawDest" placeholder="UPI / Paytm / Bank" /><br/>
  <button class="btn btn-primary" id="submitWithdrawBtn">Submit</button>
  <button class="btn btn-danger" onclick="withdrawModal.style.display='none'">Close</button>
</div>

<!-- Watch Live -->
<button class="btn btn-primary" id="watchLiveBtn">📺 Watch Live</button>
<div id="liveVideoBox">
  <iframe id="liveFrame" width="360" height="200" frameborder="0" allowfullscreen></iframe>
</div>

<!-- Music Player -->
<audio id="player"></audio>
<button class="btn btn-primary" id="musicBtn">🎵 Music</button>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
/* ================= Firebase Config ================= */
var firebaseConfig = {
  apiKey: "AIzaSyAphHTM4faH7_FVXdnootp4NipZd3vtEck",
  authDomain: "tambola69-9dc8f.firebaseapp.com",
  projectId: "tambola69-9dc8f",
  storageBucket: "tambola69-9dc8f.firebasestorage.app",
  messagingSenderId: "413290158586",
  appId: "1:413290158586:web:70fff2d94b29206487ec43";
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= Global Vars ================= */
const userTicketContainer=document.getElementById('userTicketContainer');
const latestNumber=document.getElementById('latestNumber');
const historyEl=document.getElementById('history');
const createRoomBtn=document.getElementById('createRoomBtn');
const joinRoomBtn=document.getElementById('joinRoomBtn');
const joinRoomIdInput=document.getElementById('joinRoomIdInput');
const roomBuyTicketBtn=document.getElementById('roomBuyTicketBtn');
const startRoomGameBtn=document.getElementById('startRoomGameBtn');
const roomInfoEl=document.getElementById('roomInfo');
const roomStatusPill=document.getElementById('roomStatusPill');
const playersListEl=document.getElementById('playersList');
const withdrawModal=document.getElementById('withdrawModal');
const submitWithdrawBtn=document.getElementById('submitWithdrawBtn');
const watchLiveBtn=document.getElementById('watchLiveBtn');
const liveVideoBox=document.getElementById('liveVideoBox');
const liveFrame=document.getElementById('liveFrame');
const player=document.getElementById('player');
const musicBtn=document.getElementById('musicBtn');

let activeRoom=null,isHost=false,currentGrid=null;
let autoTickToggle={checked:true};
let drawTimer;
const DRAW_INTERVAL_MS=4000;
const LS_UID="uid",LS_NAME="uname";

/* ================= Helpers ================= */
function generateTicketMatrix(){
  const grid=Array.from({length:3},()=>Array(9).fill(null));
  for(let r=0;r<3;r++){for(let c=0;c<9;c++){
    if(Math.random()<0.33) grid[r][c]=Math.floor(Math.random()*10)+c*10+1;
  }}return grid;
}
function renderTicket(grid,serial){
  userTicketContainer.innerHTML="<h3>Ticket "+serial+"</h3>";
  grid.forEach(r=>{
    r.forEach(num=>{
      const div=document.createElement('div');
      div.className="ticket-cell";
      div.textContent=num||"";
      userTicketContainer.appendChild(div);
    });
    userTicketContainer.appendChild(document.createElement("br"));
  });
}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function highlightBoard(n,hist){
  latestNumber.textContent="Number: "+n;
  historyEl.textContent=hist.join(", ");
}

/* ================= Withdraw Flow ================= */
submitWithdrawBtn.addEventListener("click",async()=>{
  const amt=parseInt(document.getElementById("withdrawAmt").value)||0;
  const dest=document.getElementById("withdrawDest").value;
  const uid=localStorage.getItem(LS_UID)||"guest";
  if(amt<=0||!dest)return alert("Invalid");
  const wref=db.ref("withdrawals").push();
  await wref.set({userId:uid,name:localStorage.getItem(LS_NAME)||"Player",
    amount:amt,dest,time:firebase.database.ServerValue.TIMESTAMP,status:"pending"});
  withdrawModal.style.display="none";
  alert("Withdrawal request sent.");
});

/* ================= Room System ================= */
let roomListeners=[];
function uiSetRoomStatus(t){roomStatusPill.textContent=t;}
function refreshPlayers(players){
  const arr=Object.entries(players||{}).map(([uid,p])=>`${p.name||'P'} ${p.paid?'✅':'❌'}`);
  playersListEl.innerHTML=arr.length?("Players: "+arr.join(" | ")):"Players: (none)";
}
async function createRoom(){
  isHost=true;
  activeRoom="room_"+Math.random().toString(36).slice(2,8);
  await db.ref("rooms/"+activeRoom).set({host:LS_UID,hostName:LS_NAME,status:"WAIT"});
  roomInfoEl.textContent="Room Created: "+activeRoom;
  joinRoomIdInput.value=activeRoom;
  startRoomGameBtn.style.display="block";startRoomGameBtn.disabled=true;
  attachRoomListeners(activeRoom);
}
async function joinRoomById(rid){
  const snap=await db.ref("rooms/"+rid).once("value");
  if(!snap.exists()) return alert("Room not found");
  activeRoom=rid;isHost=false;
  await db.ref("rooms/"+rid+"/players/"+(LS_UID)).update({name:LS_NAME||"Player",paid:false});
  roomInfoEl.textContent="Joined Room: "+rid;
  roomBuyTicketBtn.style.display="inline-block";
  attachRoomListeners(rid);
}
function attachRoomListeners(rid){
  roomListeners.forEach(r=>r.off());roomListeners=[];
  const playersRef=db.ref("rooms/"+rid+"/players");
  const statusRef=db.ref("rooms/"+rid+"/status");
  const drawRef=db.ref("rooms/"+rid+"/draw");
  playersRef.on("value",s=>{
    refreshPlayers(s.val()||{});
  });roomListeners.push(playersRef);
  statusRef.on("value",s=>{uiSetRoomStatus(s.val());});roomListeners.push(statusRef);
  drawRef.on("value",s=>{
    const d=s.val()||{},cur=d.current,hist=d.history||[];
    if(cur){highlightBoard(cur,hist);}
  });roomListeners.push(drawRef);
}
async function roomBuyTicket(){
  const grid=generateTicketMatrix();const serial=Math.floor(Math.random()*100000);
  await db.ref("rooms/"+activeRoom+"/players/"+LS_UID).update({paid:true,ticket:grid,serial});
  currentGrid=grid;renderTicket(currentGrid,"#"+serial);
}
async function startRoomGame(){
  if(!isHost)return;const nums=shuffle(Array.from({length:90},(_,i)=>i+1));
  await db.ref("rooms/"+activeRoom).update({status:"START"});
  await db.ref("rooms/"+activeRoom+"/draw").set({current:null,history:[]});
  let idx=0;clearInterval(drawTimer);
  drawTimer=setInterval(async()=>{
    if(idx>=nums.length){clearInterval(drawTimer);return;}
    const n=nums[idx++];const ref=db.ref("rooms/"+activeRoom+"/draw");
    const snap=await ref.once("value");const d=snap.val()||{history:[]};
    const hist=d.history||[];hist.push(n);await ref.update({current:n,history:hist});
  },DRAW_INTERVAL_MS);
}

/* ================= Watch Live ================= */
watchLiveBtn.addEventListener("click",()=>{
  const VIDEO_ID="YOUR_YOUTUBE_LIVE_VIDEO_ID";
  if(!VIDEO_ID||VIDEO_ID==="YOUR_YOUTUBE_LIVE_VIDEO_ID"){alert("Set YouTube Video ID");return;}
  liveFrame.src="https://www.youtube.com/embed/"+VIDEO_ID+"?autoplay=1&rel=0";
  liveVideoBox.style.display="block";watchLiveBtn.style.display="none";
});

/* ================= Music Sync ================= */
const musicRef=db.ref("music");
let isUserMuted=false;
musicRef.on("value",snap=>{
  const data=snap.val()||{};
  if(!data.url)return;
  if(player.src!==data.url) player.src=data.url;
  if(data.isPlaying&&!isUserMuted){player.play().catch(()=>{});}else{player.pause();}
});
musicBtn.addEventListener("click",()=>{
  if(player.paused){isUserMuted=false;player.play();musicBtn.style.opacity="1";}
  else{isUserMuted=true;player.pause();musicBtn.style.opacity="0.5";}
});

/* ================= Buttons ================= */
createRoomBtn.addEventListener("click",createRoom);
joinRoomBtn.addEventListener("click",()=>joinRoomById(joinRoomIdInput.value.trim()));
roomBuyTicketBtn.addEventListener("click",roomBuyTicket);
startRoomGameBtn.addEventListener("click",startRoomGame);
</script>
</body>
</html>￼Enter<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tambola 69 - User App</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#111;color:#fff;text-align:center;padding:12px}
  h1,h2,h3{color:orange;margin:8px 0}
  .ticket-cell{width:40px;height:40px;display:inline-flex;align-items:center;justify-content:center;
    border:1px solid #333;margin:2px;border-radius:6px;background:#222;font-weight:bold;color:#fff}
  .ticket-cell.ticked{background:green;color:#fff}
  .highlight{background:yellow!important;color:#000!important}
  .btn{padding:8px 12px;margin:6px;border:none;border-radius:6px;cursor:pointer;font-weight:bold}
  .btn-primary{background:orange;color:#000}
  .btn-danger{background:#ff4d4f;color:#fff}
  #liveVideoBox{display:none;margin-top:10px}
  #playersList{font-size:14px;margin:10px 0}
  #withdrawModal{display:none;position:fixed;top:20%;left:50%;transform:translateX(-50%);
    background:#222;padding:16px;border-radius:8px;z-index:999}
e>
</head>
<body>
<h1>Tambola 69 - User App</h1>

<!-- Ticket & Game UI -->
<div id="userTicketContainer"></div>
<p id="latestNumber">—</p>
<p id="history">None</p>
<div id="board"></div>

<!-- Buttons -->
<button class="btn btn-primary" id="createRoomBtn">Create Room</button>
<input id="joinRoomIdInput" placeholder="Room ID" />
<button class="btn btn-primary" id="joinRoomBtn">Join Room</button>
<button class="btn btn-primary" id="roomBuyTicketBtn" style="display:none">Buy Ticket</button>
<button class="btn btn-primary" id="startRoomGameBtn" style="display:none">Start Game</button>

<p id="roomInfo"></p>
<p id="roomStatusPill"></p>
<p id="playersList"></p>

<!-- Withdraw Modal -->
<div id="withdrawModal">
  <h3>Withdraw Request</h3>
  <input id="withdrawAmt" placeholder="Amount" /><br/>
  <input id="withdrawDest" placeholder="UPI / Paytm / Bank" /><br/>
  <button class="btn btn-primary" id="submitWithdrawBtn">Submit</button>
  <button class="btn btn-danger" onclick="withdrawModal.style.display='none'">Close</button>
</div>

<!-- Watch Live -->
<button class="btn btn-primary" id="watchLiveBtn">📺 Watch Live</button>
<div id="liveVideoBox">
  <iframe id="liveFrame" width="360" height="200" frameborder="0" allowfullscreen></iframe>
</div>

<!-- Music Player -->
<audio id="player"></audio>
<button class="btn btn-primary" id="musicBtn">🎵 Music</button>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
/* ================= Firebase Config ================= */
var firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= Global Vars ================= */
const userTicketContainer=document.getElementById('userTicketContainer');
const latestNumber=document.getElementById('latestNumber');
const historyEl=document.getElementById('history');
const createRoomBtn=document.getElementById('createRoomBtn');
const joinRoomBtn=document.getElementById('joinRoomBtn');
const joinRoomIdInput=document.getElementById('joinRoomIdInput');
const roomBuyTicketBtn=document.getElementById('roomBuyTicketBtn');
const startRoomGameBtn=document.getElementById('startRoomGameBtn');
const roomInfoEl=document.getElementById('roomInfo');
const roomStatusPill=document.getElementById('roomStatusPill');
const playersListEl=document.getElementById('playersList');
const withdrawModal=document.getElementById('withdrawModal');
const submitWithdrawBtn=document.getElementById('submitWithdrawBtn');
const watchLiveBtn=document.getElementById('watchLiveBtn');
const liveVideoBox=document.getElementById('liveVideoBox');
const liveFrame=document.getElementById('liveFrame');
const player=document.getElementById('player');
const musicBtn=document.getElementById('musicBtn');

let activeRoom=null,isHost=false,currentGrid=null;
let autoTickToggle={checked:true};
let drawTimer;
const DRAW_INTERVAL_MS=4000;
const LS_UID="uid",LS_NAME="uname";

/* ================= Helpers ================= */
function generateTicketMatrix(){
  const grid=Array.from({length:3},()=>Array(9).fill(null));
  for(let r=0;r<3;r++){for(let c=0;c<9;c++){
    if(Math.random()<0.33) grid[r][c]=Math.floor(Math.random()*10)+c*10+1;
  }}return grid;
}
function renderTicket(grid,serial){
  userTicketContainer.innerHTML="<h3>Ticket "+serial+"</h3>";
  grid.forEach(r=>{
    r.forEach(num=>{
      const div=document.createElement('div');
      div.className="ticket-cell";
      div.textContent=num||"";
      userTicketContainer.appendChild(div);
    });
    userTicketContainer.appendChild(document.createElement("br"));
  });
}
