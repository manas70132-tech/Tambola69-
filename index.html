<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tambola 69</title>
  <style>
    /* Basic reset */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#050505 0%, #0b0b0b 100%);
      color: #fff; text-align: center;
      min-height: 100vh; overflow-x: hidden;
    }

    /* PRELOADER */
    #preloader {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      z-index: 9999; gap: 18px;
      background: radial-gradient(circle at 50% 20%, rgba(255,204,0,0.06), rgba(0,0,0,0.9));
    }
    .balls { position: absolute; top: 18%; display:flex; gap:14px; justify-content:center; width:100%; pointer-events:none; }
    .ball {
      width:64px; height:64px; border-radius:50%;
      background: radial-gradient(circle at 30% 25%, #fff3c4, #ffcc00 40%, #ff7700 100%);
      display:flex; align-items:center; justify-content:center;
      font-weight:800; color:#000; font-size:20px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      animation: bob 1800ms infinite ease-in-out;
      transform-origin: center;
    }
    .ball:nth-child(2){ animation-delay: 0.25s;}
    .ball:nth-child(3){ animation-delay: 0.5s;}
    .ball:nth-child(4){ animation-delay: 0.75s;}
    .ball:nth-child(5){ animation-delay: 1s;}
    @keyframes bob {
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-22px) rotate(-6deg); }
    }

    .logo { font-size:64px; font-weight:900; letter-spacing:2px; color:#ffdd55; text-shadow:0 0 18px rgba(255,204,0,0.25); animation: glow 1800ms infinite alternate; }
    .logo span { color:#ff6600; }
    @keyframes glow {
      from { text-shadow: 0 0 8px rgba(255,204,0,0.2); transform: scale(1); }
      to { text-shadow: 0 0 36px rgba(255,102,0,0.6), 0 0 60px rgba(255,204,0,0.45); transform: scale(1.03); }
    }

    .anim-text { font-size:20px; letter-spacing:1px; opacity:0.95; animation: fade 2000ms infinite alternate; }
    @keyframes fade { from { opacity:0.4 } to { opacity:1 } }

    .welcome-line { margin-top:6px; font-size:20px; color:#ffd96b; font-weight:700; animation: hop 1700ms infinite ease-in-out; }
    @keyframes hop { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-8px);} }

    /* Login container (hidden initially) */
    #loginForm { display:none; padding:24px 16px; margin-top:10vh; }
    form {
      background: linear-gradient(180deg,#0f0f0f,#0b0b0b);
      width: 340px; margin:auto; padding:18px; border-radius:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 0 0 3px rgba(255,204,0,0.04);
      border: 1px solid rgba(255,204,0,0.05);
    }
    h2 { margin:0 0 10px 0; color:#ffdd66; font-size:22px; }
    input[type="text"], input[type="email"], input[type="tel"], input[type="number"] {
      width:100%; padding:10px 12px; margin:8px 0; border-radius:8px; border:none; outline:none;
      background:#111; color:#fff; font-size:15px;
    }
    button.primary {
      width:100%; margin-top:10px; padding:11px; border-radius:10px; border:none; cursor:pointer;
      background: linear-gradient(90deg,#ffcc00,#ff9900); font-weight:800; color:#111; font-size:15px;
    }
    button.secondary { margin-top:8px; padding:8px 12px; border-radius:8px; border:1px solid #ffcc00; background:transparent; color:#ffcc00; cursor:pointer; }

    /* small note */
    .note { font-size:13px; color:#cfcfcf; margin-top:8px; }

    /* small play button if autoplay blocked */
    #playSoundBtn {
      display:none;
      position: fixed; left: 16px; bottom: 16px; z-index: 20000;
      background: linear-gradient(90deg,#ffcc00,#ff9900); border:none; color:#111; padding:12px 16px; border-radius:10px; font-weight:800; cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }

    /* responsive */
    @media (max-width:420px) {
      .logo { font-size:44px; }
      .ball { width:52px; height:52px; font-size:18px; }
      form { width:90%; padding:14px; }
    }
  </style>
</head>
<body>

  <!-- PRELOADER -->
  <div id="preloader" aria-hidden="false">
    <!-- Audio (replace src with your generated MP3 link) -->
    <audio id="preloaderSound" preload="auto" >
      <!-- Replace the src below with your generated file URL -->
      <source src="YOUR_THEME_SOUND.mp3" type="audio/mpeg">
      Your browser does not support audio.
    </audio>

    <div class="balls" aria-hidden="true">
      <div class="ball">6</div>
      <div class="ball">9</div>
      <div class="ball">3</div>
      <div class="ball">7</div>
      <div class="ball">2</div>
    </div>

    <div class="logo">Tambola <span>69</span></div>
    <div class="anim-text">✨ Welcome to Tambola 69 ✨</div>
    <div class="welcome-line">"Apna Game, Apni Masti!"</div>
  </div>

  <!-- Play sound button fallback when autoplay blocked -->
  <button id="playSoundBtn">Play Intro ▶</button>

  <!-- LOGIN FORM -->
  <div id="loginForm" aria-hidden="true">
    <form id="authForm" onsubmit="return false;">
      <h2>Login with OTP</h2>
      <input id="name" type="text" placeholder="Full Name" required />
      <input id="email" type="email" placeholder="Email" required />
      <input id="phone" type="tel" placeholder="+91XXXXXXXXXX" required />
      <div id="recaptcha-container" style="margin-top:6px;"></div>

      <button class="primary" type="button" id="sendOtpBtn" onclick="sendOTP()">Send OTP</button>

      <input id="otpInput" type="number" placeholder="Enter OTP" style="display:none; margin-top:10px;" />
      <button class="secondary" id="verifyBtn" type="button" style="display:none;" onclick="verifyOTP()">Verify OTP</button>

      <div class="note">Phone must be in international format: +91XXXXXXXXXX</div>
    </form>
  </div>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // ====== CONFIGURE THESE BEFORE USE ======
    const firebaseConfig = {
     apiKey: "AIzaSyAphHTM4faH7_FVXdnootp4NipZd3vtEck",
  authDomain: "tambola69-9dc8f.firebaseapp.com",
  projectId: "tambola69-9dc8f",
  storageBucket: "tambola69-9dc8f.firebasestorage.app",
  messagingSenderId: "413290158586",
  appId: "1:413290158586:web:70fff2d94b29206487ec43",
  measurementId: "G-6WJNDX5DGB"  
    };
    // ========================================

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Elements
    const preloaderEl = document.getElementById('preloader');
    const loginFormEl = document.getElementById('loginForm');
    const soundEl = document.getElementById('preloaderSound');
    const playBtn = document.getElementById('playSoundBtn');

    // Try to autoplay sound; if blocked show play button
    function tryPlaySound() {
      if (!soundEl) return;
      const p = soundEl.play();
      if (p !== undefined) {
        p.then(()=> {
          playBtn.style.display = 'none';
        }).catch(()=> {
          // autoplay blocked
          playBtn.style.display = 'block';
        });
      }
    }

    // play button handler
    playBtn.addEventListener('click', ()=> {
      soundEl.play().then(()=> {
        playBtn.style.display = 'none';
      }).catch(()=> {
        alert('Audio नहीं चल रहा — कृपया मोबाइल/ब्राउज़र settings देखें।');
      });
    });

    // Show the preloader for 3 seconds then reveal login form
    const PRELOADER_MS = 3000;
    window.addEventListener('load', ()=> {
      // Attempt autoplay
      tryPlaySound();

      setTimeout(()=> {
        // stop and reset audio gracefully
        try {
          soundEl.pause();
          soundEl.currentTime = 0;
        } catch(e) {}
        preloaderEl.style.display = 'none';
        preloaderEl.setAttribute('aria-hidden','true');

        loginFormEl.style.display = 'block';
        loginFormEl.setAttribute('aria-hidden','false');
      }, PRELOADER_MS);
    });

    // ========== FIREBASE OTP ==========
    // prepare recaptcha (invisible)
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
      size: 'invisible',
      callback: function(response) {
        // console.log('recaptcha resolved');
      }
    });

    function sendOTP() {
      const phone = document.getElementById('phone').value.trim();
      if (!phone) { alert('Phone number डालें'); return; }
      // ensure E.164 format - developer must ensure correct input
      try {
        const appVerifier = window.recaptchaVerifier;
        auth.signInWithPhoneNumber(phone, appVerifier)
          .then(confirmationResult => {
            window.confirmationResult = confirmationResult;
            alert('OTP भेज दिया गया ✅');
            document.getElementById('otpInput').style.display = 'block';
            document.getElementById('verifyBtn').style.display = 'inline-block';
          })
          .catch(err => {
            console.error(err);
            alert('OTP भेजने में error: ' + (err.message || err));
            // reset recaptcha so user can try again
            window.recaptchaVerifier.render().then(widgetId => {
              grecaptcha && grecaptcha.reset(widgetId);
            }).catch(()=>{});
          });
      } catch(err) {
        console.error(err);
        alert('Recaptcha या Firebase config चेक करें।');
      }
    }

    function verifyOTP() {
      const otp = document.getElementById('otpInput').value.trim();
      if (!otp) { alert('OTP डालें'); return; }
      window.confirmationResult.confirm(otp).then(result => {
        const user = result.user;
        // collect user profile fields
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();

        // save minimal profile in realtime DB
        db.ref('users/' + user.uid).set({
          name: name || '',
          email: email || '',
          phone: phone || '',
          uid: user.uid,
          loginTime: new Date().toISOString()
        }).then(()=> {
          alert('लॉगिन सफल ✅ — Redirecting to main.html');
          // redirect
          window.location.href = 'main.html';
        }).catch(err => {
          console.error(err);
          alert('डेटाबेस में सेव करने में त्रुटि: ' + (err.message||err));
        });

      }).catch(err => {
        console.error(err);
        alert('Invalid OTP: ' + (err.message || err));
      });
    }

    // Optional: sign-out handler if needed
    function signOutUser() {
      auth.signOut().then(()=> console.log('Signed out')).catch(()=>{});
    }

    // Helpful: show console hint for dev
    console.log('Tambola69 index loaded — replace YOUR_FIREBASE_* and YOUR_THEME_SOUND.mp3 with real values.');
  </script>
</body>
</html>
