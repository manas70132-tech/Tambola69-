<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tambola Room System</title>
<style>
/* Basic Styles */
body{font-family:sans-serif;margin:0;padding:0;background:#f0f0f0;}
header,footer{background:#333;color:#fff;padding:10px;text-align:center;}
button{padding:5px 10px;margin:5px;}
#roomInfo,#latestNumber,#historyEl{margin:10px 0;}
.ticket-cell{width:40px;height:40px;display:inline-block;text-align:center;line-height:40px;border:1px solid #000;margin:1px;}
.ticked{background:#4caf50;color:#fff;}
.highlight{background:#ffeb3b;}
.show{display:block;}
#menuPanel{display:none;position:absolute;top:40px;right:10px;background:#fff;border:1px solid #000;padding:10px;}
</style>
</head>
<body>

<header>
<h1>Tambola Game</h1>
<button id="menuToggle">☰ Menu</button>
<div id="menuPanel">
  <button id="viewProfileBtn">View Profile</button>
  <button id="watchLiveBtn">Watch Live</button>
</div>
</header>

<main>
<div>
  <p id="roomInfo">No Room</p>
  <input type="text" id="joinRoomIdInput" placeholder="Enter Room ID">
  <button id="createRoomBtn">Create Room</button>
  <button id="joinRoomBtn">Join Room</button>
  <button id="roomBuyTicketBtn">Buy Ticket</button>
  <button id="startRoomGameBtn">Start Game</button>
</div>

<div id="userTicketContainer">
  <h3>Your Ticket</h3>
  <div id="ticketEl"></div>
</div>

<div>
  <p id="latestNumber">—</p>
  <p id="historyEl">None</p>
</div>

<!-- Withdraw Modal -->
<div id="withdrawModal" style="display:none;position:fixed;top:20%;left:30%;background:#fff;border:1px solid #000;padding:20px;">
  <h3>Withdraw</h3>
  <input type="number" id="withdrawAmount" placeholder="Amount"><br>
  <input type="text" id="withdrawDest" placeholder="UPI / Phone"><br>
  <button id="submitWithdrawBtn">Submit</button>
  <button id="cancelWithdrawBtn">Cancel</button>
</div>

<!-- Live Embed -->
<div id="liveVideoBox" style="display:none;">
  <iframe id="liveFrame" width="560" height="315" frameborder="0" allowfullscreen></iframe>
</div>

<!-- Firebase Recaptcha & OTP -->
<div id="recaptcha-container"></div>
<input type="text" id="phoneInput" placeholder="Phone +91xxxxxxxxxx">
<button id="sendOtpBtn">Send OTP</button>
<input type="text" id="otpInput" placeholder="Enter OTP">
<button id="verifyOtpBtn">Verify OTP</button>
<button id="saveDetailsBtn">Save Details</button>

<!-- Music Player -->
<audio id="player" controls style="display:none;"></audio>
<button id="musicBtn">Music On/Off</button>
</main>

<footer>
<p>&copy; 2025 Tambola Game</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
/* ================== Firebase Config ================== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const presenceRef = db.ref('presence');
const musicRef = db.ref('music');
let recaptchaVerifier, confirmationResult;
let myName='',myEmail='',myContact='',userId='',myPresence=null;
let currentGrid=null,autoTickToggle={checked:true},autoClaimToggle={checked:true};
const LS_UID='uid',LS_NAME='name',LS_CONTACT='contact',LS_EMAIL='email';
const DRAW_INTERVAL_MS=2000;
const ROOM_STATUS={WAIT:'WAIT',START:'START',END:'END'};
let activeRoom=null,isHost=false,drawTimer=null;

/* ================== Helper Functions ================== */
function setLocalProfile(uid,name,contact,email){
  localStorage.setItem(LS_UID,uid);
  localStorage.setItem(LS_NAME,name);
  localStorage.setItem(LS_CONTACT,contact);
  localStorage.setItem(LS_EMAIL,email);
}
function ensureGuest(){if(!localStorage.getItem(LS_UID))localStorage.setItem(LS_UID,'guest_'+Math.random().toString(36).slice(2,8));}

/* ================== Ticket Generation ================== */
function generateTicketMatrix(){
  let t=[];
  for(let i=0;i<3;i++){
    let row=[];
    while(row.length<9){
      row.push(Math.floor(Math.random()*90)+1);
    }
    t.push(row);
  }
  return t;
}
function renderTicket(grid,id){
  const container=document.getElementById('ticketEl');
  container.innerHTML='';
  grid.forEach(r=>{
    r.forEach(n=>{
      const div=document.createElement('div');
      div.className='ticket-cell'; div.textContent=n;
      container.appendChild(div);
    });
    container.appendChild(document.createElement('br'));
  });
}

/* ================== Room System ================== */
async function createRoom(){
  ensureGuest(); isHost=true;
  activeRoom='room_'+Math.random().toString(36).slice(2,8);
  await db.ref('rooms/'+activeRoom).set({host:localStorage.getItem(LS_UID),hostName:localStorage.getItem(LS_NAME),status:ROOM_STATUS.WAIT,createdAt:Date.now()});
  await db.ref(`rooms/${activeRoom}/players/${localStorage.getItem(LS_UID)}`).set({name:localStorage.getItem(LS_NAME),paid:false});
  attachRoomListeners(activeRoom);
  alert('Room created: '+activeRoom);
}
async function joinRoomById(rid){
  ensureGuest();
  const snap=await db.ref('rooms/'+rid).once('value');
  if(!snap.exists()){alert('Room not found');return;}
  activeRoom=rid; const data=snap.val();
  isHost=(data.host===localStorage.getItem(LS_UID));
  await db.ref(`rooms/${rid}/players/${localStorage.getItem(LS_UID)}`).update({name:localStorage.getItem(LS_NAME)||'Player',paid:false});
  attachRoomListeners(rid); alert('Joined room: '+rid);
}
function attachRoomListeners(rid){
  const playersRef=db.ref(`rooms/${rid}/players`);
  const statusRef=db.ref(`rooms/${rid}/status`);
  const drawRef=db.ref(`rooms/${rid}/draw`);

  playersRef.on('value',s=>{
    const players=s.val()||{};
    if(players[localStorage.getItem(LS_UID)] && players[localStorage.getItem(LS_UID)].ticket){
      currentGrid=players[localStorage.getItem(LS_UID)].ticket;
      renderTicket(currentGrid,'#ticketEl');
    }
  });
  statusRef.on('value',s=>{
    const st=s.val();
    if(st===ROOM_STATUS.WAIT){}else if(st===ROOM_STATUS.START){}else if(st===ROOM_STATUS.END){}
  });
  drawRef.on('value',s=>{});
}

/* Buy ticket */
async function roomBuyTicket(){
  if(!activeRoom)return alert('Join room first');
  alert('Payment Successful!');
  const grid=generateTicketMatrix();
  const uid=localStorage.getItem(LS_UID);
  await db.ref(`rooms/${activeRoom}/players/${uid}`).update({paid:true,ticket:grid,serial:Math.floor(Math.random()*100000)});
  currentGrid=grid; renderTicket(grid,'#ticketEl');
}

/* Start game (host) */
async function startRoomGame(){
  if(!isHost) return alert('Only host can start'); 
  const plySnap=await db.ref(`rooms/${activeRoom}/players`).once('value');
  const players=plySnap.val()||{};
  const allPaid=Object.values(players).every(p=>p.paid===true);
  if(!allPaid) return alert('All players must buy ticket');
  const nums=shuffle(Array.from({length:90},(_,i)=>i+1));
  await db.ref(`rooms/${activeRoom}`).update({status:ROOM_STATUS.START});
  await db.ref(`rooms/${activeRoom}/draw`).set({current:null,history:[],startedAt:Date.now()});
  let idx=0; clearInterval(drawTimer);
  drawTimer=setInterval(async()=>{
    if(idx>=nums.length){ clearInterval(drawTimer); await db.ref(`rooms/${activeRoom}`).update({status:ROOM_STATUS.END}); alert('Game Over'); return;}
    const n=nums[idx++];
    const ref=db.ref(`rooms/${activeRoom}/draw`);
    const snap=await ref.once('value'); const hist=snap.val().history||[];
    hist.push(n); await ref.update({current:n,history:hist});
  },DRAW_INTERVAL_MS);
}

/* Shuffle helper */
function shuffle(arr){for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr;}

/* ================== Buttons ================== */
document.getElementById('createRoomBtn').addEventListener('click',createRoom);
document.getElementById('joinRoomBtn').addEventListener('click',()=>joinRoomById(document.getElementById('joinRoomIdInput').value.trim()));
document.getElementById('roomBuyTicketBtn').addEventListener('click',roomBuyTicket);
document.getElementById('startRoomGameBtn').addEventListener('click',startRoomGame);

/* ================== Music ================== */
let player=document.getElementById('player'),isUserMuted=false;
musicRef.on('value',snap=>{
  const data=snap.val()||{};
  if(!data.url) return;
  if(player.src!==data.url)player.src=data.url;
  if(data.isPlaying && !isUserMuted) player.play().catch(()=>{}); else player.pause();
});
document.getElementById('musicBtn').addEventListener('click',()=>{
  if(player.paused){isUserMuted=false;player.play().catch(()=>{});} else{isUserMuted=true;player.pause();}
});

/* ================== Live ================== */
document.getElementById('watchLiveBtn').addEventListener('click',()=>{
  const VIDEO_ID="YOUR_YOUTUBE_LIVE_VIDEO_ID";
  if(!VIDEO_ID||VIDEO_ID==="YOUR_YOUTUBE_LIVE_VIDEO_ID"){alert('Set Video ID'); return;}
  document.getElementById('liveFrame').src="https://www.youtube.com/embed/"+VIDEO_ID+"?autoplay=1&rel=0";
  document.getElementById('liveVideoBox').style.display='block';
});

/* ================== Presence ================== */
function attachPresence(){
  try{ if(myPresence) myPresence.remove(); }catch(e){}
  const id=localStorage.getItem(LS_UID);
  myPresence=presenceRef.push({id,time:firebase.database.ServerValue.TIMESTAMP});
  myPresence.onDisconnect().remove();
}
attachPresence();

/* ================== Withdraw ================== */
document.getElementById('withdrawBtn')?.addEventListener('click',()=>document.getElementById('withdrawModal').style.display='flex');
document.getElementById('cancelWithdrawBtn')?.addEventListener('click',()=>document.getElementById('withdrawModal').style.display='none');
document.getElementById('submitWithdrawBtn')?.addEventListener('click',async()=>{
  const amt=Number(document.getElementById('withdrawAmount').value||0);
  const dest=document.getElementById('withdrawDest').value.trim();
  if(!amt||!dest) return alert('Enter amount and UPI/Phone');
  const uid=localStorage.getItem(LS_UID),name=localStorage.getItem(LS_NAME)||'Guest';
  const balSnap=await db.ref('users/'+uid+'/balance').once('value');
  const bal=balSnap.val()||0;
  if(bal<amt) return alert('Insufficient balance');
  await db.ref('users/'+uid).update({balance:bal-amt});
  await db.ref('withdrawals').push({userId:uid,name,amount:amt,dest,time:Date.now(),status:'pending'});
  document.getElementById('withdrawModal').style.display='none';
  alert('Withdrawal requested');
});
</script>

</body>
</html>￼Enter<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tambola Room System</title>
<style>
/* Basic Styles */
body{font-family:sans-serif;margin:0;padding:0;background:#f0f0f0;}
header,footer{background:#333;color:#fff;padding:10px;text-align:center;}
button{padding:5px 10px;margin:5px;}
#roomInfo,#latestNumber,#historyEl{margin:10px 0;}
.ticket-cell{width:40px;height:40px;display:inline-block;text-align:center;line-height:40px;border:1px solid #000;margin:1px;}
.ticked{background:#4caf50;color:#fff;}
.highlight{background:#ffeb3b;}
.show{display:block;}
#menuPanel{display:none;position:absolute;top:40px;right:10px;background:#fff;border:1px solid #000;padding:10px;}
</style>
</head>
<body>

<header>
<h1>Tambola Game</h1>
<button id="menuToggle">☰ Menu</button>
<div id="menuPanel">
  <button id="viewProfileBtn">View Profile</button>
  <button id="watchLiveBtn">Watch Live</button>
</div>
</header>

<main>
<div>
  <p id="roomInfo">No Room</p>
  <input type="text" id="joinRoomIdInput" placeholder="Enter Room ID">
  <button id="createRoomBtn">Create Room</button>
  <button id="joinRoomBtn">Join Room</button>
  <button id="roomBuyTicketBtn">Buy Ticket</button>
  <button id="startRoomGameBtn">Start Game</button>
</div>

<div id="userTicketContainer">
  <h3>Your Ticket</h3>
  <div id="ticketEl"></div>
</div>

<div>
  <p id="latestNumber">—</p>
  <p id="historyEl">None</p>
</div>

<!-- Withdraw Modal -->
<div id="withdrawModal" style="display:none;position:fixed;top:20%;left:30%;background:#fff;border:1px solid #000;padding:20px;">
  <h3>Withdraw</h3>
ut type="number" id="withdrawAmount" placeholder="Amount"><br>
  <input type="text" id="withdrawDest" placeholder="UPI / Phone"><br>
  <button id="submitWithdrawBtn">Submit</button>
  <button id="cancelWithdrawBtn">Cancel</button>
</div>

<!-- Live Embed -->
<div id="liveVideoBox" style="display:none;">
  <iframe id="liveFrame" width="560" height="315" frameborder="0" allowfullscreen></iframe>
</div>

<!-- Firebase Recaptcha & OTP -->
<div id="recaptcha-container"></div>
<input type="text" id="phoneInput" placeholder="Phone +91xxxxxxxxxx">
<button id="sendOtpBtn">Send OTP</button>
<input type="text" id="otpInput" placeholder="Enter OTP">
<button id="verifyOtpBtn">Verify OTP</button>
<button id="saveDetailsBtn">Save Details</button>

<!-- Music Player -->
<audio id="player" controls style="display:none;"></audio>
<button id="musicBtn">Music On/Off</button>
</main>

<footer>
<p>&copy; 2025 Tambola Game</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
/* ================== Firebase Config ================== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const presenceRef = db.ref('presence');
const musicRef = db.ref('music');
let recaptchaVerifier, confirmationResult;
let myName='',myEmail='',myContact='',userId='',myPresence=null;
let currentGrid=null,autoTickToggle={checked:true},autoClaimToggle={checked:true};
const LS_UID='uid',LS_NAME='name',LS_CONTACT='contact',LS_EMAIL='email';
const DRAW_INTERVAL_MS=2000;
const ROOM_STATUS={WAIT:'WAIT',START:'START',END:'END'};
let activeRoom=null,isHost=false,drawTimer=null;

/* ================== Helper Functions ================== */
function setLocalProfile(uid,name,contact,email){
  localStorage.setItem(LS_UID,uid);
  localStorage.setItem(LS_NAME,name);
  localStorage.setItem(LS_CONTACT,contact);
  localStorage.setItem(LS_EMAIL,email);
}
function ensureGuest(){if(!localStorage.getItem(LS_UID))localStorage.setItem(LS_UID,'guest_'+Math.random().toString(36).slice(2,8));}

/* ================== Ticket Generation ================== */
function generateTicketMatrix(){
  let t=[];
  for(let i=0;i<3;i++){
    let row=[];
    while(row.length<9){
      row.push(Math.floor(Math.random()*90)+1);
    }
    t.push(row);
  }
  return t;
}
function renderTicket(grid,id){
  const container=document.getElementById('ticketEl');
  container.innerHTML='';
  grid.forEach(r=>{
    r.forEach(n=>{
      const div=document.createElement('div');
      div.className='ticket-cell'; div.textContent=n;
      container.appendChild(div);
    });
    container.appendChild(document.createElement('br'));
  });
}

/* ================== Room System ================== */
async function createRoom(){
  ensureGuest(); isHost=true;
  activeRoom='room_'+Math.random().toString(36).slice(2,8);
  await db.ref('rooms/'+activeRoom).set({host:localStorage.getItem(LS_UID),hostName:localStorage.getItem(LS_NAME),status:ROOM_STATUS.WAIT,createdAt:Date.now()});
  await db.ref(`rooms/${activeRoom}/players/${localStorage.getItem(LS_UID)}`).set({name:localStorage.getItem(LS_NAME),paid:false});
  attachRoomListeners(activeRoom);
  alert('Room created: '+activeRoom);
}
async function joinRoomById(rid){
  ensureGuest();
  const snap=await db.ref('rooms/'+rid).once('value');
  if(!snap.exists()){alert('Room not found');return;}
  activeRoom=rid; const data=snap.val();
  isHost=(data.host===localStorage.getItem(LS_UID));
  await db.ref(`rooms/${rid}/players/${localStorage.getItem(LS_UID)}`).update({name:localStorage.getItem(LS_NAME)||'Player',paid:false});
  attachRoomListeners(rid); alert('Joined room: '+rid);
}
function attachRoomListeners(rid){
