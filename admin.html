<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tambola 69</title>
<style>
body{font-family:Arial;background:#111;color:#fff;text-align:center;margin:0;padding:0;}
#splash{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;flex-direction:column;background:#111;color:orange;font-size:2rem;z-index:1000;animation:fadeOut 3s forwards 3s;}
@keyframes fadeOut{100%{opacity:0;display:none;}}
.board{display:grid;grid-template-columns:repeat(10,40px);gap:5px;justify-content:center;margin:10px;}
.tile{width:40px;height:40px;background:#222;display:flex;justify-content:center;align-items:center;border-radius:5px;transition:transform 0.3s,background 0.3s;}
.highlight{background:orange;color:#000;font-weight:bold;transform:scale(1.3);animation:blink 0.5s;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.5;}}
#ticket-board div{display:flex;justify-content:center;gap:5px;margin:5px;}
input,button{margin:5px;padding:5px;}
#login-form{display:none;}
</style>
</head>
<body>

<div id="splash">
  <h1>Tambola 69</h1>
  <p>Get Ready!</p>
</div>

<h2>Tambola Game</h2>
<div>Prize %: <span id="prize-percent">50</span>%</div>
<div>Countdown: <span id="countdown">300</span>s</div>

<div class="board" id="number-board"></div>

<div id="ticket-section">
  <h3>Your Ticket</h3>
  <div id="ticket-board"></div>
  <button id="buy-ticket-btn">Buy Ticket</button>
</div>

<button id="share-btn">Share</button>

<div id="login-form">
<input type="text" id="username" placeholder="Enter name">
<button id="login-btn">Login</button>
</div>

<h3>Top Winners</h3>
<ol id="top-winners-list"></ol>

<audio id="live-audio" controls autoplay style="width:90%;margin:10px;"></audio>
<video id="live-video" controls autoplay loop width="400" style="margin:10px;"></video>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase Config - replace with your keys
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Splash Animation handled by CSS

// Generate number board 1-90
const board=document.getElementById('number-board');
for(let i=1;i<=90;i++){
  let tile=document.createElement('div');
  tile.id='tile-'+i;
  tile.className='tile';
  tile.innerText=i;
  board.appendChild(tile);
}

// Sample User Ticket array (replace after purchase)
let userTicket=[];
const ticketBoard=document.getElementById('ticket-board');

// Buy Ticket (placeholder for payment integration)
document.getElementById('buy-ticket-btn').addEventListener('click', ()=>{
  if(!localStorage.getItem('username')){
    document.getElementById('login-form').style.display='block';
  } else {
    // Simulate ticket purchase, replace with Razorpay/UPI integration
    userTicket=[[1,15,30,45,60],[2,18,33,48,63],[5,20,35,50,65],[6,22,37,52,70],[10,25,40,55,75]];
    ticketBoard.innerHTML='';
    userTicket.forEach((row,rowIndex)=>{
      let rowDiv=document.createElement('div');
      row.forEach((num,colIndex)=>{
        let cell=document.createElement('div');
        cell.id=`ticket-${rowIndex}-${colIndex}`;
        cell.className='tile';
        cell.innerText=num;
        rowDiv.appendChild(cell);
      });
      ticketBoard.appendChild(rowDiv);
    });
  }
});

// Share Button
document.getElementById('share-btn').addEventListener('click', ()=>{
  if(!localStorage.getItem('username')){
    document.getElementById('login-form').style.display='block';
  } else {shareGame();}
});
document.getElementById('login-btn').addEventListener('click', ()=>{
  let user=document.getElementById('username').value.trim();
  if(user){localStorage.setItem('username',user);document.getElementById('login-form').style.display='none';shareGame();}
});
function shareGame(){
  let url=window.location.href;
  navigator.share ? navigator.share({title:"Tambola 69",url}) : alert("Share this link: "+url);
}

// Listen Drawn Numbers
db.ref('game/drawnNumbers').on('child_added', snapshot=>{
  let number=snapshot.val();
  highlightNumber(number);
  tickTicket(number);
  announceNumber(number);
});

// Highlight on board
function highlightNumber(num){
  let tile=document.getElementById('tile-'+num);
  if(tile){tile.classList.add('highlight'); setTimeout(()=>tile.classList.remove('highlight'),1000);}
}

// Tick ticket numbers
function tickTicket(num){
  userTicket.forEach((row,rowIndex)=>{
    row.forEach((val,colIndex)=>{
      if(val===num){
        document.getElementById(`ticket-${rowIndex}-${colIndex}`).classList.add('highlight');
      }
    });
  });
  checkWinner();
}

// AI voice announcement
function announceNumber(num){
  let msg=new SpeechSynthesisUtterance(num);
  window.speechSynthesis.speak(msg);
}

// Prize %
db.ref('game/prizePercent').on('value', snapshot=>{
  document.getElementById('prize-percent').innerText=snapshot.val();
});

// Countdown Timer
db.ref('game/countdown').on('value', snapshot=>{
  let time=snapshot.val();
  startCountdown(time);
});
let countdownInterval;
function startCountdown(sec){
  clearInterval(countdownInterval);
  document.getElementById('countdown').innerText=sec;
  countdownInterval=setInterval(()=>{
    sec--;
    document.getElementById('countdown').innerText=sec;
    if(sec<=0) clearInterval(countdownInterval);
  },1000);
}

// Top Winners
db.ref('game/topWinners').on('value', snapshot=>{
  let winners=snapshot.val()||[];
  const list=document.getElementById('top-winners-list');
  list.innerHTML='';
  winners.forEach(w=>{let li=document.createElement('li');li.innerText=w;list.appendChild(li);});
});

// Automatic Winner Detection
function checkWinner(){
  // Early 5
  let count=0;
  userTicket.forEach(row=>row.forEach(num=>{let tile=document.getElementById(`ticket-${userTicket.indexOf(row)}-${row.indexOf(num)}`);if(tile.classList.contains('highlight')) count++;}));
  if(count>=5) console.log("Early 5 Winner!");

  // Full House
  let all=true;
  userTicket.forEach(row=>row.forEach(num=>{let tile=document.getElementById(`ticket-${userTicket.indexOf(row)}-${row.indexOf(num)}`);if(!tile.classList.contains('highlight')) all=false;}));
  if(all) console.log("Full House Winner!");
}

// Live Audio/Video
db.ref('game/mediaURL').on('value', snapshot=>{
  let url=snapshot.val();
  if(!url) return;
  if(url.endsWith('.mp3')||url.endsWith('.wav')){
    let audio=document.getElementById('live-audio'); audio.src=url; audio.play();
  }
  if(url.endsWith('.mp4')||url.endsWith('.webm')){
    let video=document.getElementById('live-video'); video.src=url; video.play();
  }
});
</script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tambola Admin Panel</title>
<style>
  body { font-family: Arial; background:#111; color:#fff; text-align:center; padding:20px; }
  input { padding:8px; border-radius:6px; }
  button { padding:8px 16px; margin:5px; }
  ul { list-style:none; padding:0; margin-top:20px; }
</style>
</head>
<body>
<h2>Tambola Admin Panel</h2>

<input id="numberInput" placeholder="Enter Number" />
<br><br>
<button id="saveBtn">Save Number</button>
<button id="loadBtn">Load Numbers</button>

<ul id="numberList"></ul>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
  // 🔹 Firebase Config – अपने Firebase keys डालो
  const firebaseConfig = {
    apiKey: "AIzaSyAphHTM4faH7_FVXdnootp4NipZd3vtEck",
    authDomain: "tambola69-9dc8f.firebaseapp.com",
    projectId: "tambola69-9dc8f",
    storageBucket: "tambola69-9dc8f.appspot.com",
    messagingSenderId: "413290158586",
    appId: "1:413290158586:web:70fff2d94b29206487ec43"
  };

  // Init Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const numbersRef = db.collection("numbers");

  // Save number
  document.getElementById("saveBtn").onclick = async () => {
    const number = document.getElementById("numberInput").value;
    if (!number) { alert("Enter a number!"); return; }
    await numbersRef.add({ value: number, timestamp: new Date() });
    alert("Saved: " + number);
    document.getElementById("numberInput").value = "";
  };

  // Load numbers
  document.getElementById("loadBtn").onclick = async () => {
    const snapshot = await numbersRef.orderBy("timestamp").get();
    const list = document.getElementById("numberList");
    list.innerHTML = "";
    snapshot.forEach(doc => {
      const li = document.createElement("li");
      li.textContent = "Number: " + doc.data().value;
      list.appendChild(li);
    });
  };
</script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tambola Admin Panel</title>
  <style>
    body { font-family: Arial; background:#111; color:#fff; text-align:center; padding:20px; }
    input { padding:8px; border-radius:6px; }
    button { padding:8px 16px; margin:5px; }
    ul { list-style:none; padding:0; }
  </style>
</head>
<body>
  <h2>Tambola Admin Panel</h2>

  <input id="numberInput" placeholder="Enter Number" />
  <br><br>
  <button id="saveBtn">Save Number</button>
  <button id="loadBtn">Load Numbers</button>

  <ul id="numberList"></ul>

  <script type="module">
    // 🔹 Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // 🔹 Your Firebase Config – इसे अपने Firebase project के details से replace करो
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const numbersRef = collection(db, "numbers");

    // Save number
    async function saveNumber() {
      const number = document.getElementById("numberInput").value;
      if (!number) { alert("Enter a number!"); return; }
      await addDoc(numbersRef, { value: number, timestamp: new Date() });
      alert("Saved: " + number);
      document.getElementById("numberInput").value = "";
    }

    // Load numbers
    async function loadNumbers() {
      const list = document.getElementById("numberList");
      list.innerHTML = "";
      const snapshot = await getDocs(numbersRef);
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = `Number: ${doc.data().value}`;
        list.appendChild(li);
      });
    }

    document.getElementById("saveBtn").addEventListener("click", saveNumber);
    document.getElementById("loadBtn").addEventListener("click", loadNumbers);
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tambola 69 - Full Admin Panel</title>
<style>
  body { font-family: Arial, Helvetica, sans-serif; background: #111; color: #fff; text-align: center; padding: 18px; }
  h1,h2,h3 { color: orange; margin: 10px 0; }
  .section { background: #222; padding: 14px; margin: 12px auto; max-width: 1000px; border-radius: 10px; text-align:left; }
  input, button, select, textarea { font-size: 15px; padding: 8px; margin: 6px 4px; border-radius: 6px; border: none; }
  button { background: orange; color: #000; cursor: pointer; font-weight: 700; }
  button:hover { background:#ff8800; }
  .action-row { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .live-box { background:#000; padding:8px 10px; border-radius:8px; display:inline-block; margin-left:8px; }
  .tambola-board, .ticket-board { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
  .board-cell, .ticket-cell { width:40px; height:40px; display:flex; align-items:center; justify-content:center; background:#333; border-radius:6px; font-weight:bold; color:#fff; cursor:pointer; }
  .board-cell.drawn { background:#000; color:#ff0; }
  .winner-card { background:#000; padding:10px; margin:8px 0; border-radius:8px; }
  .claim-card { background:#1a1a1a; padding:10px; margin:8px 0; border-radius:8px; display:flex; justify-content:space-between; align-items:center; gap:10px; }
  .room-select { background:#111; padding:8px; border-radius:8px; display:flex; gap:8px; align-items:center; }
  .small { font-size:13px; padding:6px; }
  textarea { width:100%; min-height:60px; border-radius:6px; }
  .muted { color:#bbb; font-size:13px; }
  /* Slider table */
  .table-wrap{ overflow:auto; border-radius:8px; border:1px solid #333; }
  table { width:100%; border-collapse: collapse; }
  th, td { padding:8px; border-bottom:1px solid #333; vertical-align: top; text-align:left; }
  th { position: sticky; top:0; background:#1b1b1b; }
  .row-actions button{ margin:0 4px; padding:6px 8px; }
  .w-120{ width:120px; }
  .w-160{ width:160px; }
  .w-220{ width:220px; }
  /* withdrawal / tickets table */
  .table-small{ width:100%; border-collapse:collapse; margin-top:8px }
  .table-small th, .table-small td { padding:8px; border-bottom:1px solid #333; font-size:14px; text-align:left }
  .btn-ghost{ background:transparent; border:1px solid #333; color:#fff; padding:6px 8px; border-radius:6px; cursor:pointer }
  .btn-danger{ background:#ff4d4f; color:#fff; padding:6px 8px; border-radius:6px; cursor:pointer; border:none }
</style>
</head>
<body>
<h1>🎛️ Tambola 69 - Admin Panel</h1>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* =======================
   
/* =======================
   Put your Firebase config here
   ======================= */
var firebaseConfig = {
  apiKey: "AIzaSyAphHTM4faH7_FVXdnootp4NipZd3vtEck",
  authDomain: "tambola69-9dc8f.firebaseapp.com",
  databaseURL: "tambola69-9dc8f.firebaseio.com",
  projectId: "tambola69-9dc8f",
  storageBucket: "tambola69-9dc8f.appspot.com",
  messagingSenderId: "413290158586",
  appId: "1:413290158586:web:70fff2d94b29206487ec43"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Database reference
var db = firebase.database();
/* Top-level refs */
const currentGameRef = db.ref('currentGame');
const nextGameRef = db.ref('nextGame');
let selectedRoom = "Room1";
let friendsGameRef = db.ref('rooms').child(selectedRoom).child('friendsGame');

/* Helper to return ref by key */
function refFor(key){
  if(key==='current') return currentGameRef;
  if(key==='next') return nextGameRef;
  if(key==='friends') return friendsGameRef;
  return null;
}

/* ===========================
   🎵 Music Control
   =========================== */
const musicRef = db.ref("music");

function saveMusicUrl(){
  const url = document.getElementById("musicUrlInput").value.trim();
  if(!url) return alert("Enter music URL first");
  musicRef.update({ url });
  alert("Music URL updated ✅");
}

async function toggleMusic(){
  const snap = await musicRef.once("value");
  const data = snap.val() || {};
  const newState = !data.isPlaying;
  musicRef.update({ isPlaying: newState });
  const btn = document.getElementById("toggleMusicBtn");
  if(btn) btn.innerText = newState ? "⏸ Pause" : "▶️ Play";
}

musicRef.on("value", snap=>{
  const data = snap.val() || {};
  const urlInput = document.getElementById("musicUrlInput");
  const tBtn = document.getElementById("toggleMusicBtn");
  if(urlInput) urlInput.value = data.url || "";
  if(tBtn) tBtn.innerText = data.isPlaying ? "⏸ Pause" : "▶️ Play";
});

/* ===========================
   🎬 Video Control (simple stubs so buttons work)
   =========================== */
const videoRef = db.ref("video");
function saveVideoUrl(){
  const url = (document.getElementById('videoUrlInput')||{}).value || '';
  if(!url.trim()) return alert('वीडियो URL डालें');
  videoRef.update({ url });
  alert('वीडियो URL सेव ✅');
}
async function toggleVideo(){
  const snap = await videoRef.once('value');
  const d = snap.val() || {};
  const isPlaying = !d.isPlaying;
  await videoRef.update({ isPlaying });
  const b = document.getElementById('toggleVideoBtn');
  if(b) b.innerText = isPlaying ? '⏸ पॉज़' : '▶️ प्ले';
}

/* ===========================
   🖼️ Advanced Slider Control (NEW)
   =========================== */
const sliderRef = db.ref('slider');
let localSlides = []; // mirror for UI table

function blankSlide(){
  return { src:'', linkUrl:'', title:'', buttonText:'', buttonUrl:'', width:'', height:'' };
}

function renderSlidesTable(){
  const tbody = document.getElementById('slidesTbody');
  if(!tbody) return;
  tbody.innerHTML = '';
  localSlides.forEach((s, i)=>{
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td class="row-actions">
        <button onclick="moveSlide(${i}, -1)">↑</button>
        <button onclick="moveSlide(${i}, 1)">↓</button>
        <button onclick="deleteSlide(${i})">🗑</button>
      </td>
      <td><input class="w-220" placeholder="Image URL" value="${escapeHtml(s.src)}" oninput="onCellChange(${i}, 'src', this.value)"></td>
      <td><input class="w-220" placeholder="Link URL (image click)" value="${escapeHtml(s.linkUrl||'')}" oninput="onCellChange(${i}, 'linkUrl', this.value)"></td>
      <td><input class="w-220" placeholder="Title / Text (overlay)" value="${escapeHtml(s.title||'')}" oninput="onCellChange(${i}, 'title', this.value)"></td>
      <td>
        <input class="w-160" placeholder="Button Text" value="${escapeHtml(s.buttonText||'')}" oninput="onCellChange(${i}, 'buttonText', this.value)">
        <input class="w-220" placeholder="Button Link URL" value="${escapeHtml(s.buttonUrl||'')}" oninput="onCellChange(${i}, 'buttonUrl', this.value)">
      </td>
      <td>
        <input class="w-120" type="number" min="0" placeholder="Width (px)" value="${escapeHtml(s.width||'')}" oninput="onCellChange(${i}, 'width', this.value)">
        <input class="w-120" type="number" min="0" placeholder="Height (px)" value="${escapeHtml(s.height||'')}" oninput="onCellChange(${i}, 'height', this.value)">
      </td>
    `;
    tbody.appendChild(tr);
  });
  document.getElementById('slidesCount').innerText = localSlides.length;
}

function onCellChange(i, key, val){
  localSlides[i][key] = val;
}

function addSlideRow(){
  localSlides.push(blankSlide());
  renderSlidesTable();
}

function deleteSlide(i){
  if(!confirm('Delete this slide?')) return;
  localSlides.splice(i,1);
  renderSlidesTable();
}

function moveSlide(i, dir){
  const j = i + dir;
  if(j<0 || j>=localSlides.length) return;
  const tmp = localSlides[i];
  localSlides[i] = localSlides[j];
  localSlides[j] = tmp;
  renderSlidesTable();
}

function saveSlidesAdvanced(){
  const cleaned = localSlides
    .map(s=>({
      src: (s.src||'').trim(),
      linkUrl: (s.linkUrl||'').trim(),
      title: (s.title||'').trim(),
      buttonText: (s.buttonText||'').trim(),
      buttonUrl: (s.buttonUrl||'').trim(),
      width: s.width!=='' ? Number(s.width) : '',
      height: s.height!=='' ? Number(s.height) : ''
    }))
    .filter(s=>s.src);

  if(!cleaned.length) return alert('कम-से-कम एक slide का Image URL भरें');

  sliderRef.update({ slides: cleaned })
    .then(()=>alert('Slides updated ✅'))
    .catch(e=>alert(e.message));
}

async function toggleSliderPlay(){
  const snap = await sliderRef.once('value');
  const data = snap.val() || {};
  const newState = !data.isPlaying;
  await sliderRef.update({ isPlaying: newState });
  const btn = document.getElementById('toggleSliderBtn');
  if(btn) btn.innerText = newState ? '⏸ Pause' : '▶️ Play';
}

function nextSlide(){
  sliderRef.child('currentIndex').transaction(i => (typeof i === 'number' ? i : 0) + 1);
}

function prevSlide(){
  sliderRef.child('currentIndex').transaction(i => {
    const cur = (typeof i === 'number' ? i : 0);
    return cur - 1;
  });
}

function goToSlide(){
  const idx = parseInt((document.getElementById('gotoIndexInput')||{}).value) || 0;
  sliderRef.update({ currentIndex: idx });
}

function setSpeed(){
  const ms = parseInt((document.getElementById('speedInput')||{}).value) || 0;
  if(ms < 500) return alert('Minimum 500 ms');
  sliderRef.update({ speedMs: ms });
  const sd = document.getElementById('speedDisplay');
  if(sd) sd.innerText = ms + ' ms';
}

sliderRef.on('value', snap=>{
  const d = snap.val() || {};
  localSlides = Array.isArray(d.slides) ? JSON.parse(JSON.stringify(d.slides)) : [];
  renderSlidesTable();

  const tBtn = document.getElementById('toggleSliderBtn');
  if(tBtn) tBtn.innerText = d.isPlaying ? '⏸ Pause' : '▶️ Play';
  const idxDisp = document.getElementById('currentIndexDisplay');
  if(idxDisp) idxDisp.innerText = (typeof d.currentIndex==='number' ? d.currentIndex : 0);
  const spDisp = document.getElementById('speedDisplay');
  if(spDisp) spDisp.innerText = (d.speedMs || 0) + ' ms';
});

/* ===========================
   Start / Stop / Reset Game (UNCHANGED)
   =========================== */
function startGame(key){
  const ref = refFor(key);
  if(!ref) return alert('Invalid game key');
  ref.update({ status: 'started', startTime: new Date().toISOString() });
  updateStatusUI(key,'started');
  alert(key + ' started ✅');
}

function stopGame(key){
  const ref = refFor(key);
  if(!ref) return alert('Invalid game key');
  ref.update({ status: 'stopped', stopTime: new Date().toISOString() });
  updateStatusUI(key,'stopped');
  alert(key + ' stopped ⏹');
}

function resetGame(key){
  const ref = refFor(key);
  if(!ref) return alert('Invalid game key');
  ref.update({
    status: 'idle',
    liveNumber: null,
    countdown: null,
    ticketsLeft: null,
    totalSpots: null
  }).then(()=>{
    clearBoardHighlights(key);
    updateStatusUI(key,'idle');
    alert(key + ' reset to idle 🔄');
  }).catch(e=>alert(e.message));
}

function updateStatusUI(key, value){
  if(key==='current') document.getElementById('currentStatusDisplay').innerText = value;
  if(key==='next')    document.getElementById('nextStatusDisplay').innerText = value;
  if(key==='friends') document.getElementById('friendsStatusDisplay').innerText = value;
}

function clearBoardHighlights(game){
  const id = (game==='current') ? 'currentTambolaBoard' : (game==='next') ? 'nextTambolaBoard' : 'friendsTambolaBoard';
  const board = document.getElementById(id);
  if(!board) return;
  Array.from(board.children).forEach(c=>c.classList.remove('drawn'));
}

/* ===========================
   Number broadcast + auto draw (UNCHANGED)
   =========================== */
function broadcastNumber(game='current'){
  const inputId = (game==='current') ? 'currentNumberInput' : (game==='next') ? 'nextNumberInput' : 'friendsNumberInput';
  const val = parseInt(document.getElementById(inputId).value);
  if(!val || val<1 || val>90) return alert('Enter number 1-90');
  const r = refFor(game);
  r.child('liveNumber').set(val);
}

const autoTimers = { current:null, next:null, friends:null };
function autoDrawNumber(game='current'){
  clearInterval(autoTimers[game]);
  autoTimers[game] = setInterval(()=>{
    const num = Math.floor(Math.random()*90)+1;
    const r = refFor(game);
    r.child('liveNumber').set(num);
  }, 30000);
}

function generateBoard(game='current'){
  const boardId = (game==='current') ? 'currentTambolaBoard' : (game==='next') ? 'nextTambolaBoard' : 'friendsTambolaBoard';
  const board = document.getElementById(boardId);
  if(!board) return;
  board.innerHTML = '';
  for(let i=1;i<=90;i++){
    const cell = document.createElement('div');
    cell.className = 'board-cell';
    cell.id = game + 'Cell' + i;
    cell.innerText = i;
    board.appendChild(cell);
  }
}

currentGameRef.child('liveNumber').on('value', snap=>{
  const num = snap.val();
  if(num) highlightNumber('current', num);
});
nextGameRef.child('liveNumber').on('value', snap=>{
  const num = snap.val();
  if(num) highlightNumber('next', num);
});
function highlightNumber(game, num){
  const el = document.getElementById(game+'Cell'+num);
  if(el) el.classList.add('drawn');
}

/* ===========================
   Prize / Tickets / Spots / Countdown updates (UNCHANGED)
   =========================== */
function updatePrize(game){
  const id = (game==='current') ? 'currentPrizeInput' : (game==='next') ? 'nextPrizeInput' : 'friendsPrizeInput';
  const v = parseInt(document.getElementById(id).value) || 0;
  if(v<1 || v>100) return alert('Enter % between 1-100');
  refFor(game).child('prizePercentage').set(v);
  document.getElementById(game + 'PrizeDisplay').innerText = v + '%';
}
function updateTickets(game){
  const id = (game==='current') ? 'currentTicketsInput' : (game==='next') ? 'nextTicketsInput' : 'friendsTicketsInput';
  const v = parseInt(document.getElementById(id).value) || 0;
  refFor(game).child('ticketsLeft').set(v);
  document.getElementById(game + 'TicketsDisplay').innerText = v;
}
function updateSpots(game){
  const id = (game==='current') ? 'currentSpotsInput' : (game==='next') ? 'nextSpotsInput' : 'friendsSpotsInput';
  const v = parseInt(document.getElementById(id).value) || 0;
  refFor(game).child('totalSpots').set(v);
  document.getElementById(game + 'SpotsDisplay').innerText = v;
}
function updateCountdown(game){
  const id = (game==='current') ? 'currentCountdownInput' : (game==='next') ? 'nextCountdownInput' : 'friendsCountdownInput';
  const v = parseInt(document.getElementById(id).value) || 0;
  if(v < 5) return alert('Countdown must be at least 5s');
  refFor(game).child('countdown').set(v);
  document.getElementById(game + 'CountdownDisplay').innerText = v + 's';
}

/* ===========================
   Winners: per-winner update + save all (UNCHANGED)
   =========================== */
function loadWinnersForm(game='current'){
  const formId = (game==='current') ? 'currentWinnersForm'
               : (game==='next') ? 'nextWinnersForm'
               : 'friendsWinnersForm';
  let html = '';
  for(let i=1;i<=10;i++){
    html += `<div class="winner-card">
      <b>Winner #${i}</b><br>
      Name: <input id="${game}Name${i}" placeholder="Name"><br>
      Phone: <input id="${game}Phone${i}" placeholder="Phone"><br>
      Prize (₹): <input id="${game}Prize${i}" type="number"><br>
      <button type="button" onclick="saveSingleWinner('${game}',${i})">Update Winner #${i}</button>
    </div>`;
  }
  document.getElementById(formId).innerHTML = html;
}

function saveSingleWinner(game, i){
  const ref = refFor(game).child('winners');
  const name = document.getElementById(game+'Name'+i).value.trim();
  const phone = document.getElementById(game+'Phone'+i).value.trim();
  const prize = parseInt(document.getElementById(game+'Prize'+i).value) || 0;
  if(!name || !phone) return alert('Enter Name and Phone for Winner #' + i);
  ref.child('winner'+i).set({ name, phone, prize });
  alert('Winner #' + i + ' updated for ' + game);
}

function saveAllWinners(game){
  const ref = refFor(game).child('winners');
  let payload = {};
  for(let i=1;i<=10;i++){
    const name = document.getElementById(game+'Name'+i).value.trim();
    const phone = document.getElementById(game+'Phone'+i).value.trim();
    const prize = parseInt(document.getElementById(game+'Prize'+i).value) || 0;
    if(!name || !phone) { alert('Enter Name & Phone for Winner #' + i); return; }
    payload['winner'+i] = { name, phone, prize };
  }
  ref.set(payload).then(()=>alert('All winners saved for ' + game));
}

/* ===========================
  Notifications (UPDATED - target / broadcast)
  =========================== */
function sendNotification(){
  const msg = (document.getElementById('notifyMessage')||{}).value || '';
  const to = (document.getElementById('notifyTo')||{}).value || '';
  const broadcast = document.getElementById('notifyBroadcast') && document.getElementById('notifyBroadcast').checked;
  if(!msg.trim()) return alert('Enter message');

  const payload = { message: msg.trim(), time: new Date().toISOString(), from: 'admin' };

  if(broadcast){
    // push a broadcast record and also store per-user if you want
    payload.to = 'all';
    db.ref('notifications').push(payload);
    alert('Broadcast notification sent ✅');
  } else if(to.trim()){
    payload.to = to.trim();
    db.ref('notifications').push(payload);
    // also push under userNotifications for quick client lookup
    db.ref('userNotifications').child(to.trim()).push(payload);
    alert('Notification sent to ' + to.trim() + ' ✅');
  } else {
    // fallback - push to notifications without target
    db.ref('notifications').push(payload);
    alert('Notification pushed to notifications (no target) ✅');
  }
  document.getElementById('notifyMessage').value = '';
  document.getElementById('notifyTo').value = '';
  if(document.getElementById('notifyBroadcast')) document.getElementById('notifyBroadcast').checked = false;
}

/* ===========================
  Rooms list + change (UNCHANGED)
  =========================== */
function fillRooms(){
  const select = document.getElementById('roomDropdown');
  select.innerHTML = '';
  for(let i=1;i<=1000;i++){
    const opt = document.createElement('option');
    opt.value = 'Room'+i;
    opt.innerText = 'Room ' + i;
    select.appendChild(opt);
  }
  select.value = selectedRoom;
}
function filterRooms(){
  const q = (document.getElementById('roomSearch')||{}).value.toLowerCase();
  const select = document.getElementById('roomDropdown');
  Array.from(select.options).forEach(opt=>{
    opt.style.display = opt.text.toLowerCase().includes(q) ? '' : 'none';
  });
}
function changeRoom(){
  const sel = document.getElementById('roomDropdown').value || 'Room1';
  try { friendsGameRef.child('liveNumber').off(); friendsGameRef.child('status').off(); } catch(e){}
  selectedRoom = sel;
  friendsGameRef = db.ref('rooms').child(selectedRoom).child('friendsGame');
  alert('Now controlling ' + selectedRoom);
  generateBoard('friends');
  friendsGameRef.child('liveNumber').on('value', snap => { if(snap.val()) highlightNumber('friends', snap.val()); });
  friendsGameRef.child('status').on('value', snap => { document.getElementById('friendsStatusDisplay').innerText = snap.val() || 'idle'; });
}

/* ===========================
  Claims system (UNCHANGED)
  =========================== */
function bindClaimsListener(){
  const list = document.getElementById('claimsList');
  db.ref('claims').on('value', snap=>{
    const data = snap.val() || {};
    let html = '';
    Object.keys(data).forEach(id=>{
      const c = data[id];
      const status = c.status || 'pending';
      html += `<div class="claim-card">
        <div style="flex:1">
          <div><b>User:</b> ${escapeHtml(c.user||'Unknown')}</div>
          <div class="muted"><b>Type:</b> ${escapeHtml(c.type||'claim')}</div>
          <div class="muted"><b>Ticket:</b> ${escapeHtml(c.ticketId||'N/A')}</div>
          <div class="muted"><b>Time:</b> ${escapeHtml(c.time||'')}</div>
          <div class="muted"><b>Status:</b> ${escapeHtml(status)}</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button type="button" onclick="approveClaim('${id}')">✅ Approve</button>
          <button type="button" onclick="rejectClaim('${id}')">❌ Reject</button>
        </div>
      </div>`;
    });
    list.innerHTML = html || '<div class="muted">No claims yet</div>';
  });
}
function approveClaim(id){
  db.ref('claims/'+id).update({ status: 'approved', reviewedBy: 'admin', reviewedAt: new Date().toISOString() });
  // send notification to user (if claim has user)
  db.ref('claims/'+id).once('value').then(snap=>{
    const c = snap.val() || {};
    if(c.user) db.ref('userNotifications').child(c.user).push({ message: 'Your claim has been approved', time: new Date().toISOString(), from:'admin' });
  });
  alert('Claim approved ✅');
}
function rejectClaim(id){
  db.ref('claims/'+id).update({ status: 'rejected', reviewedBy: 'admin', reviewedAt: new Date().toISOString() });
  db.ref('claims/'+id).once('value').then(snap=>{
    const c = snap.val() || {};
    if(c.user) db.ref('userNotifications').child(c.user).push({ message: 'Your claim was rejected', time: new Date().toISOString(), from:'admin' });
  });
  alert('Claim rejected ❌');
}

/* ===========================
  WITHDRAWALS (NEW)
  DB path: /withdrawals/{withdrawId} => { user, amount, method, status, requestedAt, game? }
  =========================== */
function bindWithdrawalsListener(){
  const out = document.getElementById('withdrawalsList');
  db.ref('withdrawals').on('value', snap=>{
    const data = snap.val() || {};
    let rows = '';
    Object.keys(data).forEach(id=>{
      const w = data[id];
      const status = w.status || 'pending';
      const requested = w.requestedAt ? escapeHtml(w.requestedAt) : '';
      rows += `<tr>
        <td><b>${escapeHtml(w.user||'unknown')}</b><div class="muted">${escapeHtml(id)}</div></td>
        <td>₹${escapeHtml(w.amount||0)}</td>
        <td>${escapeHtml(w.method||'--')}</td>
        <td>${escapeHtml(w.game||'global')}</td>
        <td>${escapeHtml(status)}</td>
        <td>${requested}</td>
        <td>
          ${status==='pending' ? `<button onclick="approveWithdraw('${id}')" class="btn-ghost">Approve</button>
          <button onclick="rejectWithdrawPrompt('${id}')" class="btn-danger">Reject</button>` : `<button class="btn-ghost" onclick="viewWithdraw('${id}')">View</button>`}
        </td>
      </tr>`;
    });
    if(!rows) rows = '<tr><td colspan="7" class="muted">No withdrawal requests</td></tr>';
    out.innerHTML = `<table class="table-small"><thead><tr><th>User</th><th>Amount</th><th>Method</th><th>Game</th><th>Status</th><th>Requested</th><th>Action</th></tr></thead><tbody>${rows}</tbody></table>`;

    // Also render into per-game placeholders (current/next/friends) summary
    renderWithdrawalsPerGame(data);
  });
}

function approveWithdraw(id){
  const wRef = db.ref('withdrawals/' + id);
  wRef.once('value').then(snap=>{
    const w = snap.val() || {};
    wRef.update({ status:'approved', reviewedBy:'admin', reviewedAt:new Date().toISOString() });
    // send user notification
    if(w.user) {
      db.ref('userNotifications').child(w.user).push({ message: `Your withdrawal ₹${w.amount} approved`, time: new Date().toISOString(), from:'admin' });
    }
    alert('Withdrawal approved ✅');
  }).catch(e => alert(e.message));
}

function rejectWithdrawPrompt(id){
  const reason = prompt('Enter rejection reason (optional):','');
  if(reason === null) return; // cancel
  rejectWithdraw(id, reason);
}

function rejectWithdraw(id, reason){
  const wRef = db.ref('withdrawals/' + id);
  wRef.once('value').then(snap=>{
    const w = snap.val() || {};
    wRef.update({ status:'rejected', reviewedBy:'admin', reviewedAt:new Date().toISOString(), rejectionReason: reason||'' });
    if(w.user) {
      db.ref('userNotifications').child(w.user).push({ message: `Your withdrawal ₹${w.amount} was rejected: ${reason||'No reason'}`, time: new Date().toISOString(), from:'admin' });
    }
    alert('Withdrawal rejected ❌');
  }).catch(e => alert(e.message));
}

function viewWithdraw(id){
  db.ref('withdrawals/'+id).once('value').then(snap=>{
    const w = snap.val() || {};
    alert(`User: ${w.user}\nAmount: ₹${w.amount}\nMethod: ${w.method}\nStatus: ${w.status}\nRequested: ${w.requestedAt||''}\nReason: ${w.rejectionReason||''}`);
  });
}

// helper to render withdraws inside current/next/friends placeholders by filtering on w.game (if present)
function renderWithdrawalsPerGame(data){
  const currentEl = document.getElementById('currentWithdrawals');
  const nextEl = document.getElementById('nextWithdrawals');
  const friendsEl = document.getElementById('friendsWithdrawals');

  const arr = Object.keys(data||{}).map(k => ({ id:k, ...data[k] }));
  function shortHtmlFor(list){
    if(!list || list.length===0) return '<div class="muted">No requests</div>';
    return list.map(w=>`<div style="padding:6px 0;border-bottom:1px solid #333"><b>${escapeHtml(w.user)}</b> — ₹${escapeHtml(w.amount)} — <span class="muted">${escapeHtml(w.status||'')}</span></div>`).join('');
  }

  const cur = arr.filter(x => (x.game||'current') === 'current' || (!x.game && true)); // show unspecified also
  const nx = arr.filter(x => x.game === 'next');
  const fr = arr.filter(x => x.game === 'friends');

  if(currentEl) currentEl.innerHTML = shortHtmlFor(cur);
  if(nextEl) nextEl.innerHTML = shortHtmlFor(nx);
  if(friendsEl) friendsEl.innerHTML = shortHtmlFor(fr);
}

/* ===========================
  USER TICKETS VIEW (NEW)
  DB path expected: /users/{userId} => { name, tickets: { t1: [..], t2:[..] } or tickets: [ [..], [..] ] }
  =========================== */
function bindUsersListener(){
  const out = document.getElementById('usersTicketsList');
  db.ref('users').on('value', snap=>{
    const data = snap.val() || {};
    let rows = '';
    Object.keys(data).forEach(uid=>{
      const u = data[uid] || {};
      // normalize tickets
      let tickets = u.tickets || u.ticketList || [];
      // if object, convert
      if(tickets && typeof tickets === 'object' && !Array.isArray(tickets)){
        tickets = Object.keys(tickets).map(k => tickets[k]);
      }
      const ticketDisplay = (Array.isArray(tickets) && tickets.length) ? tickets.map(t=>escapeHtml(Array.isArray(t)? t.join(', '): JSON.stringify(t))).join('<br>') : '<span class="muted">No tickets</span>';
      rows += `<tr>
        <td><b>${escapeHtml(uid)}</b><div class="muted">${escapeHtml(u.name||'')}</div></td>
        <td>${(Array.isArray(tickets) ? tickets.length : 0)}</td>
        <td>${ticketDisplay}</td>
      </tr>`;
    });
    if(!rows) rows = '<tr><td colspan="3" class="muted">No users found</td></tr>';
    out.innerHTML = `<table class="table-small"><thead><tr><th>User ID</th><th># Tickets</th><th>Tickets (numbers)</th></tr></thead><tbody>${rows}</tbody></table>`;
  });
}

/* ===========================
  Status listeners (UNCHANGED)
  =========================== */
currentGameRef.child('status').on('value', snap => {
  document.getElementById('currentStatusDisplay').innerText = snap.val() || 'idle';
});
nextGameRef.child('status').on('value', snap => {
  document.getElementById('nextStatusDisplay').innerText = snap.val() || 'idle';
});

/* ===========================
  Init on load (UNCHANGED + bind new listeners)
  =========================== */
window.onload = function(){
  ['current','next','friends'].forEach(g=>{
    generateBoard(g);
    loadWinnersForm(g);
  });
  fillRooms();
  try {
    friendsGameRef.child('liveNumber').on('value', snap => { if(snap.val()) highlightNumber('friends', snap.val()); });
    friendsGameRef.child('status').on('value', snap => { document.getElementById('friendsStatusDisplay').innerText = snap.val() || 'idle'; });
  } catch(e){ console.warn(e); }
  bindClaimsListener();

  // New binds
  bindWithdrawalsListener();
  bindUsersListener();
}

/* helper */
function escapeHtml(str){
  return String(str||'').replace(/[&<>"'`]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[s]));
}
</script>

<!-- ===========================
BODY UI sections
=========================== -->

<!-- 🔊 Music Control -->
<div class="section">
  <h2>🎵 Music Control</h2>
  <input type="text" id="musicUrlInput" placeholder="Enter music stream URL" style="width:70%">
  <button onclick="saveMusicUrl()">Save URL</button>
  <button id="toggleMusicBtn" onclick="toggleMusic()">▶️ Play</button>
  <div class="muted" style="margin-top:6px">Clients will auto-play if their local mute is off.</div>
</div>

<!-- 🎬 वीडियो कंट्रोल सेक्शन -->
<div class="section">
  <h2>🎬 वीडियो कंट्रोल</h2>
  <input type="text" id="videoUrlInput" placeholder="वीडियो स्ट्रीम URL डालें" style="width:70%">
  <button onclick="saveVideoUrl()">URL सेव करें</button>
  <button id="toggleVideoBtn" onclick="toggleVideo()">▶️ प्ले</button>
  <div class="muted" style="margin-top:6px">क्लाइंट्स वीडियो ऑटो-प्ले करेंगे अगर उनका म्यूट ऑफ है।</div>
</div>

<!-- 🖼️ Slider Control (Advanced) -->
<div class="section">
  <h2>🖼️ Slider Control</h2>
  <div class="action-row" style="margin-bottom:8px">
    <button onclick="addSlideRow()">+ Add Slide</button>
    <button onclick="saveSlidesAdvanced()">Save Slides</button>
    <button id="toggleSliderBtn" onclick="toggleSliderPlay()">▶️ Play</button>
    <button onclick="prevSlide()">⏮ Prev</button>
    <button onclick="nextSlide()">⏭ Next</button>
    <input id="gotoIndexInput" type="number" class="small" placeholder="Go to index">
    <button onclick="goToSlide()">Go</button>
    <input id="speedInput" type="number" class="small" placeholder="Speed (ms)">
    <button onclick="setSpeed()">Set Speed</button>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:160px">Actions</th>
          <th>Image URL</th>
          <th>Link URL (on image)</th>
          <th>Title / Text (overlay)</th>
          <th>Button (text + link)</th>
          <th>Size (px)</th>
        </tr>
      </thead>
      <tbody id="slidesTbody"></tbody>
    </table>
  </div>

  <div style="margin-top:10px">
    <div class="live-box">Slides: <span id="slidesCount">0</span></div>
    <div class="live-box">Index: <span id="currentIndexDisplay">0</span></div>
    <div class="live-box">Speed: <span id="speedDisplay">0 ms</span></div>
  </div>

  <div class="muted" style="margin-top:6px">
    Clients should read <code>/slider</code> ⇒ <code>{ slides[], currentIndex, isPlaying, speedMs }</code>.<br>
    Each slide: <code>{ src, linkUrl, title, buttonText, buttonUrl, width, height }</code>
  </div>
</div>

<!-- Current Game -->
<div class="section">
  <h2>🟢 Current Game</h2>
  <div class="action-row">
    <button onclick="startGame('current')">Start Game</button>
    <button onclick="stopGame('current')">Stop Game</button>
    <button onclick="resetGame('current')">Reset Game</button>
    <div class="live-box">Status: <span id="currentStatusDisplay">idle</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="currentPrizeInput" type="number" min="1" max="100" placeholder="Prize %"><button onclick="updatePrize('current')">Update Prize</button>
    <div class="live-box">Prize: <span id="currentPrizeDisplay">0%</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="currentTicketsInput" type="number" min="0" placeholder="Tickets Left"><button onclick="updateTickets('current')">Update Tickets</button>
    <div class="live-box">Tickets Left: <span id="currentTicketsDisplay">0</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="currentSpotsInput" type="number" min="0" placeholder="Total Spots"><button onclick="updateSpots('current')">Update Spots</button>
    <div class="live-box">Total Spots: <span id="currentSpotsDisplay">0</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="currentCountdownInput" type="number" min="5" placeholder="Countdown seconds"><button onclick="updateCountdown('current')">Update Countdown</button>
    <div class="live-box">Countdown: <span id="currentCountdownDisplay">0s</span></div>
  </div>

  <div class="action-row" style="margin-top:8px">
    <input id="currentNumberInput" type="number" min="1" max="90" placeholder="Draw Number">
    <button onclick="broadcastNumber('current')">Broadcast Number</button>
    <button onclick="autoDrawNumber('current')">Auto Draw Every 30s</button>
  </div>

  <h3>Top 10 Winners</h3>
  <form id="currentWinnersForm"></form>
  <button onclick="saveAllWinners('current')">Save All Winners</button>

  <h3>Tambola Board</h3>
  <div id="currentTambolaBoard" class="tambola-board"></div>

  <h3>User Tickets</h3><div id="currentUserTickets" class="user-tickets"></div>
  <h3>Prize Claim Notifications</h3><div id="currentNotifications"></div>
  <h3>Withdrawal Requests</h3><div id="currentWithdrawals"></div>
</div>

<!-- Next Game -->
<div class="section">
  <h2>🟡 Next Game</h2>
  <div class="action-row">
    <button onclick="startGame('next')">Start Game</button>
    <button onclick="stopGame('next')">Stop Game</button>
    <button onclick="resetGame('next')">Reset Game</button>
    <div class="live-box">Status: <span id="nextStatusDisplay">idle</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="nextPrizeInput" type="number" min="1" max="100" placeholder="Prize %"><button onclick="updatePrize('next')">Update Prize</button>
    <div class="live-box">Prize: <span id="nextPrizeDisplay">0%</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="nextTicketsInput" type="number" min="0" placeholder="Tickets Left"><button onclick="updateTickets('next')">Update Tickets</button>
    <div class="live-box">Tickets Left: <span id="nextTicketsDisplay">0</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="nextSpotsInput" type="number" min="0" placeholder="Total Spots"><button onclick="updateSpots('next')">Update Spots</button>
    <div class="live-box">Total Spots: <span id="nextSpotsDisplay">0</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="nextCountdownInput" type="number" min="5" placeholder="Countdown seconds"><button onclick="updateCountdown('next')">Update Countdown</button>
    <div class="live-box">Countdown: <span id="nextCountdownDisplay">0s</span></div>
  </div>

  <div class="action-row" style="margin-top:8px">
    <input id="nextNumberInput" type="number" min="1" max="90" placeholder="Draw Number">
    <button onclick="broadcastNumber('next')">Broadcast Number</button>
    <button onclick="autoDrawNumber('next')">Auto Draw Every 30s</button>
  </div>

  <h3>Top 10 Winners</h3>
  <form id="nextWinnersForm"></form>
  <button onclick="saveAllWinners('next')">Save All Winners</button>

  <h3>Tambola Board</h3>
  <div id="nextTambolaBoard" class="tambola-board"></div>

  <h3>User Tickets</h3><div id="nextUserTickets" class="user-tickets"></div>
  <h3>Prize Claim Notifications</h3><div id="nextNotifications"></div>
  <h3>Withdrawal Requests</h3><div id="nextWithdrawals"></div>
</div>

<!-- Friends Game -->
<div class="section">
  <h2>🎮 Play With Friends</h2>
  <div class="action-row">
    <button onclick="startGame('friends')">Start Game</button>
    <button onclick="stopGame('friends')">Stop Game</button>
    <button onclick="resetGame('friends')">Reset Game</button>
    <div class="live-box">Status: <span id="friendsStatusDisplay">idle</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="friendsPrizeInput" type="number" min="1" max="100" placeholder="Prize %"><button onclick="updatePrize('friends')">Update Prize</button>
    <div class="live-box">Prize: <span id="friendsPrizeDisplay">0%</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="friendsSpotsInput" type="number" min="0" placeholder="Total Spots"><button onclick="updateSpots('friends')">Update Spots</button>
    <div class="live-box">Total Spots: <span id="friendsSpotsDisplay">0</span></div>
  </div>

  <div style="margin-top:8px">
    <input id="friendsCountdownInput" type="number" min="5" placeholder="Countdown seconds"><button onclick="updateCountdown('friends')">Update Countdown</button>
    <div class="live-box">Countdown: <span id="friendsCountdownDisplay">0s</span></div>
  </div>

  <div class="action-row" style="margin-top:8px">
    <input id="friendsNumberInput" type="number" min="1" max="90" placeholder="Draw Number">
    <button onclick="broadcastNumber('friends')">Broadcast Number</button>
    <button onclick="autoDrawNumber('friends')">Auto Draw Every 30s</button>
  </div>

  <div class="room-select" style="margin-top:10px">
    <input type="text" id="roomSearch" onkeyup="filterRooms()" placeholder="🔍 Search Room...">
    <select id="roomDropdown" onchange="changeRoom()"></select>
  </div>

  <h3>Top 10 Winners</h3>
  <form id="friendsWinnersForm"></form>
  <button onclick="saveAllWinners('friends')">Save All Winners</button>

  <h3>Tambola Board</h3>
  <div id="friendsTambolaBoard" class="tambola-board"></div>

  <h3>User Tickets</h3><div id="friendsUserTickets" class="user-tickets"></div>
  <h3>Prize Claim Notifications</h3><div id="friendsNotifications"></div>
  <h3>Withdrawal Requests</h3><div id="friendsWithdrawals"></div>
</div>

<!-- Notifications -->
<div class="section">
  <h2>📢 Notifications</h2>
  <div style="display:flex;gap:8px;align-items:center;">
    <input id="notifyTo" type="text" placeholder="User ID (leave empty for broadcast) - e.g. user123" style="width:40%">
    <label style="display:flex;align-items:center;gap:6px;"><input id="notifyBroadcast" type="checkbox"> Broadcast to all</label>
  </div>
  <textarea id="notifyMessage" placeholder="Enter message for users..."></textarea>
  <div style="display:flex;gap:8px;">
    <button onclick="sendNotification()">Send Notification</button>
  </div>
  <div class="muted" style="margin-top:8px">Notifications are pushed to <code>/notifications</code>. For specific users also stored under <code>/userNotifications/{userId}</code>.</div>
</div>

<!-- Withdrawals (new section) -->
<div class="section">
  <h2>💸 Withdrawal Requests</h2>
  <div id="withdrawalsList" class="muted">Loading withdrawals...</div>
  <div class="muted" style="margin-top:8px">Approve / Reject will update <code>/withdrawals/{id}</code> status and send a user notification under <code>/userNotifications/{userId}</code>.</div>
</div>

<!-- User Tickets (new section) -->
<div class="section">
  <h2>👥 User Tickets</h2>
  <div id="usersTicketsList" class="muted">Loading users & tickets...</div>
  <div class="muted" style="margin-top:8px">Put users under <code>/users/{userId}</code> with <code>tickets</code> array/object to auto-display here.</div>
</div>

<!-- Claims -->
<div class="section">
  <h2>🏆 Claims</h2>
  <div id="claimsList" class="muted">Loading claims...</div>
</div>

<!-- (Optional) Admin quick controls -->
<div class="section">
  <h2>⚙️ Quick admin</h2>
  <button onclick="generateBoard('current')">Regenerate Current Board UI</button>
  <button onclick="generateBoard('next')">Regenerate Next Board UI</button>
  <button onclick="generateBoard('friends')">Regenerate Friends Board UI</button>
</div>

</body>
</html>
